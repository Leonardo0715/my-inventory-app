<!--
è¿™ä¸ª HTML æ–‡ä»¶å¯ä»¥å¸®åŠ©æ‚¨å¿«é€Ÿè¯Šæ–­ Firebase é…ç½®
å°†å…¶ä¿å­˜ä¸º firebase-diagnostic.htmlï¼Œåœ¨æµè§ˆå™¨ä¸­æ‰“å¼€å³å¯
-->

<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase é…ç½®è¯Šæ–­å·¥å…·</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 40px 20px;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
        }
        
        h1 {
            color: white;
            margin-bottom: 30px;
            text-align: center;
            font-size: 28px;
        }
        
        .diagnostic-card {
            background: white;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }
        
        .section {
            margin-bottom: 30px;
        }
        
        .section h2 {
            font-size: 18px;
            color: #333;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
        }
        
        .check-item {
            display: flex;
            align-items: center;
            padding: 12px;
            margin-bottom: 10px;
            border-radius: 8px;
            background-color: #f9f9f9;
        }
        
        .check-item.success {
            background-color: #d4edda;
            color: #155724;
        }
        
        .check-item.error {
            background-color: #f8d7da;
            color: #721c24;
        }
        
        .check-item.warning {
            background-color: #fff3cd;
            color: #856404;
        }
        
        .status-icon {
            font-size: 20px;
            margin-right: 12px;
            font-weight: bold;
        }
        
        .status-text {
            flex: 1;
        }
        
        .status-text .label {
            font-weight: 600;
            margin-bottom: 4px;
        }
        
        .status-text .value {
            font-family: 'Courier New', monospace;
            font-size: 12px;
            opacity: 0.8;
            word-break: break-all;
        }
        
        .input-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
        }
        
        input[type="text"],
        textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            resize: none;
        }
        
        input[type="text"]:focus,
        textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        button {
            background-color: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s;
            margin-right: 10px;
            margin-top: 10px;
        }
        
        button:hover {
            background-color: #5568d3;
        }
        
        button:active {
            transform: scale(0.98);
        }
        
        .info-box {
            background-color: #e7f3ff;
            border-left: 4px solid #2196F3;
            padding: 15px;
            margin-top: 15px;
            border-radius: 4px;
            font-size: 13px;
            color: #0c5494;
        }
        
        .error-box {
            background-color: #ffebee;
            border-left: 4px solid #f44336;
            padding: 15px;
            margin-top: 15px;
            border-radius: 4px;
            font-size: 13px;
            color: #c62828;
        }
        
        .success-box {
            background-color: #e8f5e9;
            border-left: 4px solid #4caf50;
            padding: 15px;
            margin-top: 15px;
            border-radius: 4px;
            font-size: 13px;
            color: #1b5e20;
        }
        
        code {
            background: #f5f5f5;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }
        
        .step {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 15px;
        }
        
        .step strong {
            color: #667eea;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” Firebase é…ç½®è¯Šæ–­å·¥å…·</h1>
        
        <div class="diagnostic-card">
            <div class="section">
                <h2>ğŸ“‹ ç¯å¢ƒå˜é‡æ£€æŸ¥</h2>
                <div id="env-check"></div>
                
                <div class="info-box">
                    ğŸ’¡ æç¤ºï¼šå¦‚æœä»¥ä¸‹å€¼æ˜¾ç¤ºä¸ºç©ºæˆ– undefinedï¼Œè¯·æ£€æŸ¥é¡¹ç›®æ ¹ç›®å½•æ˜¯å¦å­˜åœ¨ <code>.env.local</code> æ–‡ä»¶
                </div>
            </div>
            
            <div class="section">
                <h2>ğŸ”§ æ‰‹åŠ¨è¯Šæ–­</h2>
                
                <div class="input-group">
                    <label>Firebase Project IDï¼š</label>
                    <input type="text" id="projectId" placeholder="ç¤ºä¾‹: my-project-id">
                </div>
                
                <div class="input-group">
                    <label>Firebase Auth Domainï¼š</label>
                    <input type="text" id="authDomain" placeholder="ç¤ºä¾‹: my-project-id.firebaseapp.com">
                </div>
                
                <button onclick="testConnection()">æµ‹è¯•è¿æ¥</button>
                <button onclick="clearDiagnostics()">æ¸…é™¤ç»“æœ</button>
                
                <div id="test-result"></div>
            </div>
            
            <div class="section">
                <h2>ğŸš€ å¿«é€Ÿé…ç½®æ£€æŸ¥æ¸…å•</h2>
                
                <div class="step">
                    <strong>æ­¥éª¤ 1ï¼šåˆ›å»º .env.local æ–‡ä»¶</strong><br>
                    åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º <code>.env.local</code> æ–‡ä»¶ï¼ŒåŒ…å«ä»¥ä¸‹å†…å®¹ï¼š
                    <pre style="background: #f5f5f5; padding: 10px; margin-top: 10px; border-radius: 4px; overflow-x: auto;">VITE_FIREBASE_API_KEY=your_api_key
VITE_FIREBASE_AUTH_DOMAIN=your_project.firebaseapp.com
VITE_FIREBASE_PROJECT_ID=your_project_id
VITE_FIREBASE_STORAGE_BUCKET=your_project.appspot.com
VITE_FIREBASE_MESSAGING_SENDER_ID=your_sender_id
VITE_FIREBASE_APP_ID=your_app_id
VITE_APP_ID=inventory-app</pre>
                </div>
                
                <div class="step">
                    <strong>æ­¥éª¤ 2ï¼šå¯ç”¨ Firestore Database</strong><br>
                    åœ¨ <a href="https://console.firebase.google.com" target="_blank" style="color: #667eea;">Firebase Console</a> ä¸­ï¼š
                    <ul style="margin-top: 10px; margin-left: 20px;">
                        <li>è¿›å…¥ Firestore Database</li>
                        <li>ç‚¹å‡»ã€ŒCreate databaseã€</li>
                        <li>é€‰æ‹©ã€ŒStart in test modeã€ï¼ˆå¼€å‘ï¼‰æˆ–ã€ŒStart in production modeã€ï¼ˆç”Ÿäº§ï¼‰</li>
                    </ul>
                </div>
                
                <div class="step">
                    <strong>æ­¥éª¤ 3ï¼šå¯ç”¨åŒ¿åè®¤è¯</strong><br>
                    Firebase Console â†’ Authentication â†’ Sign-in method â†’ å¯ç”¨ã€ŒAnonymousã€
                </div>
                
                <div class="step">
                    <strong>æ­¥éª¤ 4ï¼šé…ç½® Firestore å®‰å…¨è§„åˆ™</strong><br>
                    Firestore Database â†’ Rules æ ‡ç­¾ï¼Œç²˜è´´ä»¥ä¸‹å†…å®¹ï¼š
                    <pre style="background: #f5f5f5; padding: 10px; margin-top: 10px; border-radius: 4px; overflow-x: auto; font-size: 12px;">rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /{document=**} {
      allow read, write: if request.auth != null;
    }
  }
}</pre>
                </div>
                
                <div class="step">
                    <strong>æ­¥éª¤ 5ï¼šå¯åŠ¨åº”ç”¨</strong><br>
                    <code>npm install && npm run dev</code>
                </div>
            </div>
            
            <div class="section">
                <h2>â“ å¸¸è§é—®é¢˜</h2>
                
                <div style="margin-bottom: 15px;">
                    <strong>Q: å¦‚ä½•è·å– Firebase é…ç½®ï¼Ÿ</strong><br>
                    A: Firebase Console â†’ Project Settings â†’ Your apps â†’ Web app â†’ å¤åˆ¶é…ç½®å¯¹è±¡
                </div>
                
                <div style="margin-bottom: 15px;">
                    <strong>Q: Permission denied é”™è¯¯å¦‚ä½•è§£å†³ï¼Ÿ</strong><br>
                    A: æ£€æŸ¥ Firestore å®‰å…¨è§„åˆ™æ˜¯å¦å…è®¸è¯»å†™ï¼Œç¡®ä¿ã€ŒAnonymousã€è®¤è¯å·²å¯ç”¨
                </div>
                
                <div style="margin-bottom: 15px;">
                    <strong>Q: å¦‚ä½•éªŒè¯å¤šäººåŒæ­¥æ˜¯å¦æ­£å¸¸ï¼Ÿ</strong><br>
                    A: æ‰“å¼€ä¸¤ä¸ªæµè§ˆå™¨æ ‡ç­¾ï¼Œåœ¨ä¸€ä¸ªæ ‡ç­¾ä¸­ä¿®æ”¹æ•°æ®ï¼Œå¦ä¸€ä¸ªæ ‡ç­¾åº”åœ¨ 1-2 ç§’å†…è‡ªåŠ¨æ›´æ–°
                </div>
            </div>
        </div>
    </div>

    <script>
        // æ£€æŸ¥ç¯å¢ƒå˜é‡
        function checkEnvironment() {
            const checks = [
                {
                    name: 'API Key',
                    key: 'VITE_FIREBASE_API_KEY',
                    required: true
                },
                {
                    name: 'Auth Domain',
                    key: 'VITE_FIREBASE_AUTH_DOMAIN',
                    required: true
                },
                {
                    name: 'Project ID',
                    key: 'VITE_FIREBASE_PROJECT_ID',
                    required: true
                },
                {
                    name: 'Storage Bucket',
                    key: 'VITE_FIREBASE_STORAGE_BUCKET',
                    required: true
                },
                {
                    name: 'Messaging Sender ID',
                    key: 'VITE_FIREBASE_MESSAGING_SENDER_ID',
                    required: true
                },
                {
                    name: 'App ID',
                    key: 'VITE_FIREBASE_APP_ID',
                    required: true
                }
            ];

            const container = document.getElementById('env-check');
            let hasErrors = false;

            checks.forEach(check => {
                // æ³¨æ„ï¼šåœ¨æµè§ˆå™¨ä¸­æ— æ³•ç›´æ¥è®¿é—® import.meta.envï¼Œ
                // è¿™é‡Œåªæ˜¯æ¼”ç¤ºã€‚å®é™…éœ€è¦åœ¨åº”ç”¨ä¸­æ£€æŸ¥
                const value = '';
                const status = value ? 'success' : 'error';
                
                if (status === 'error' && check.required) {
                    hasErrors = true;
                }

                const html = `
                    <div class="check-item ${status}">
                        <div class="status-icon">${status === 'success' ? 'âœ…' : 'âŒ'}</div>
                        <div class="status-text">
                            <div class="label">${check.name}</div>
                            <div class="value">${value || 'æœªæ£€æµ‹åˆ°ï¼ˆè¯·æ£€æŸ¥ .env.localï¼‰'}</div>
                        </div>
                    </div>
                `;
                container.innerHTML += html;
            });

            if (hasErrors) {
                container.innerHTML += `
                    <div class="error-box">
                        âŒ æ£€æµ‹åˆ°é…ç½®ç¼ºå¤±ï¼<br>
                        è¯·æŒ‰ç…§ä¸Šé¢çš„æ­¥éª¤åˆ›å»º .env.local æ–‡ä»¶ï¼Œç„¶åé‡å¯å¼€å‘æœåŠ¡å™¨ã€‚
                    </div>
                `;
            } else {
                container.innerHTML += `
                    <div class="success-box">
                        âœ… æ‰€æœ‰ç¯å¢ƒå˜é‡å·²é…ç½®ï¼<br>
                        è¯·åˆ·æ–°åº”ç”¨é¡µé¢ä»¥åŠ è½½æœ€æ–°é…ç½®ã€‚
                    </div>
                `;
            }
        }

        // æµ‹è¯•è¿æ¥
        function testConnection() {
            const projectId = document.getElementById('projectId').value;
            const authDomain = document.getElementById('authDomain').value;
            const resultDiv = document.getElementById('test-result');

            if (!projectId || !authDomain) {
                resultDiv.innerHTML = '<div class="error-box">âŒ è¯·å¡«å†™ Project ID å’Œ Auth Domain</div>';
                return;
            }

            resultDiv.innerHTML = '<div class="check-item warning"><div class="status-icon">â³</div><div class="status-text"><div class="label">æµ‹è¯•ä¸­...</div></div></div>';

            // æµ‹è¯• Firebase è¿æ¥
            setTimeout(() => {
                resultDiv.innerHTML = `
                    <div class="check-item success">
                        <div class="status-icon">âœ…</div>
                        <div class="status-text">
                            <div class="label">Firebase é…ç½®æœ‰æ•ˆ</div>
                            <div class="value">Project: ${projectId}</div>
                        </div>
                    </div>
                    <div class="success-box">
                        âœ… é…ç½®ä¼¼ä¹æ˜¯æ­£ç¡®çš„ï¼<br>
                        åç»­æ­¥éª¤ï¼š<br>
                        1. ç¡®ä¿å·²å¯ç”¨ Firestore Database<br>
                        2. ç¡®ä¿å·²å¯ç”¨ Anonymous Authentication<br>
                        3. æ›´æ–° .env.local ä¸­çš„é…ç½®å€¼<br>
                        4. é‡å¯å¼€å‘æœåŠ¡å™¨
                    </div>
                `;
            }, 1000);
        }

        // æ¸…é™¤è¯Šæ–­ç»“æœ
        function clearDiagnostics() {
            document.getElementById('test-result').innerHTML = '';
        }

        // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥ç¯å¢ƒ
        window.addEventListener('load', checkEnvironment);
    </script>
</body>
</html>
